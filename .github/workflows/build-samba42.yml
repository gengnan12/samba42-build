name: Build Samba Server for ARMv5

on:
  workflow_dispatch: # 允许手动触发工作流

env:
  SAMBA_VERSION: "4.10.18" # 使用支持旧配置选项的稳定版本

jobs:
  build:
    runs-on: ubuntu-20.04 # 使用更旧的Ubuntu版本以更好兼容

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3 # 使用旧版本的checkout

    - name: Install dependencies and cross-toolchain
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          build-essential \
          wget \
          pkg-config \
          python2.7 \
          python-dev \
          libacl1-dev \
          libattr1-dev \
          libblkid-dev \
          libgnutls28-dev \
          libreadline-dev \
          gcc-arm-linux-gnueabi \
          g++-arm-linux-gnueabi

    - name: Download Samba source
      run: |
        wget https://download.samba.org/pub/samba/stable/samba-$SAMBA_VERSION.tar.gz
        tar -xzf samba-$SAMBA_VERSION.tar.gz
        echo "SAMBA_SOURCE_DIR=samba-$SAMBA_VERSION" >> $GITHUB_ENV

    - name: Configure Samba for ARMv5
      run: |
        cd $SAMBA_SOURCE_DIR

        # 创建详细的交叉编译答案文件
        cat > cross-answers.txt << 'EOF'
        Checking simple C program: yes
        Checking for
